# 嵌套抽样



## 总述



John Skilling(2006)提出了一种计算边缘似然值的新方法：嵌套抽样算法(Nested Sampling Algorithm，NSE)。该方法基于贝叶斯理论，其核心是将复杂的高维积分转化为便于数值计算的一维积分。不同于AME或HME仅在先验或后验概率空间内抽样，也不是简单地将先验与后验空间混合，嵌套抽样法在抽样的过程中由先验空间逐步过渡到后验空间，从而有效降低了从单一分布抽样引起的边缘似然值估计误差。嵌套抽样算法可以看作一种全局优化算法，因为其利用的有效参数集遍历了整个先验分布及后验分布。目前，嵌套抽样方法已经在多个领域得到推广应用，如Elsheikh(2013)等将基于Metropolis-Hasting的嵌套抽样算法(NSE-MH)应用于地下水流模型的评价与不确定性分析，验证了嵌套抽样算法的有效性；Liu(2016)等对NSE-MH中Metropolis-Hasting算法进行改进，分别应用于线性、非线性函数的边缘似然值计算，并与算术平均、调和平均及热力学积分(TIE)方法的计算结果对比，验证了改进后的嵌套抽样算法的计算精度与效率。

嵌套抽样算法(NSE)将复杂的高维积分问题转化为一维积分问题。在具体实施过程中，嵌套抽样算法可以分为嵌套抽样主算法和局部限制抽样子算法(Constrained local sampling)两部分，主算法通过有效集迭代更新的方式实现嵌套抽样，局部限制抽样负责生成每次迭代过程所需的似然值～先验分布累积(L～X)样本。局部限制抽样通常基于概率抽样方法，如Metropolis-Hasting(MH)算法等。

对于常规的基于Metropolis-Hasting算法的嵌套抽样算法(NSE-MH)，该算法原理简单，容易操作，但在应用过程中存在以下问题：①NSE-MH算法的计算效率低，所需的计算量大；②NSE-MH算法的收敛速度慢，在抽样后期MH算法需要多次迭代才能生成满足约束条件(Li+l＞Li)的样本；③NSE-MH算法在参数后验分布空间内随机抽样，计算稳定性稳定性较差。因此，上述问题的存在限制了嵌套抽样算法在模型评价中应用和推广。

嵌套抽样过程是一种计算逆积分态密度$U(X)$的算法。嵌套抽样的中心过程只有两个参数：嵌套抽样产生一系列嵌套样本集，这些样本的能量根据状态密度分布。X的误差累积率由参数K设定，。参数L应设置得足够大，以使相关样本来自每个样本的可能性相等。

嵌套抽样探索一系列嵌套均匀分布，构造成具有常熟分数重叠形式。因此，这些分布式计算有效的平衡和系统的病理行为，且能避免一阶相变。这使得嵌套抽样成为寻找相变的理想工具。

嵌套抽样的微正则冷却过程应该是发现“未知的未知相变”的强大工具。



## 1 图形化介绍嵌套抽样过程



![image-20211009164649276](C:\Users\李二妞\AppData\Roaming\Typora\typora-user-images\image-20211009164649276.png)



中央嵌套采样程序（或循环）的图解如图1所示，在每次迭代开始时，我们从$U（q）<U_lim$区域的均匀分布中得到$K$个配置，其中$U_lim$依赖于迭代。在每次迭代中，$U_lim$被缩减。这就是“嵌套抽样”名称的基础。

从$U（q）<U_lim$区域均匀随机抽取的样本值$X(U)$)是从$[0, x(U_lim)]$区域随机抽取的。如果考虑连续的配置空间划分成等体积的小块，并将这些小块沿着一条线排列，从高能量到低能量进行分类。线的长度与配置空间的体积相对应。也就是说，从空间中随机选择的结构对应于在直线上随机选择的一个点，如图所示



![image-20211009164743452](C:\Users\李二妞\AppData\Roaming\Typora\typora-user-images\image-20211009164743452.png)





## 2  嵌套抽样算法

每个$X$都是从前面的$X_{i-1}$中找到的，其中且$U(X_i-1)>U(X_i)$,因此，抽样是内向进行的，朝向能量越来越低的方向。

在任意迭代i中，我们有K个构型${q1,q2,q3,…qk}$在$U(q)≤U_lim$上均匀分布。这里$U_lim=U_{i-1}$，构型能恰好对应于我们得到的$log X_{i-1}$，描述这种情况的式子是：


$$
ρ（q|U_{lim})=\begin{cases} \frac{1}{X(U_lim)},U(q) \leq U_lim\\0, Elsewhere \end{cases}
$$


我们称这种分布为“有界均匀分布”。对于构型能量$U(q)≤U_lim$的构建空间均匀绘制的构型，$U$的pdf就是$Ulim$的态密度：


$$
ρ（U|U_{lim})=\begin{cases} \frac{g(U)}{X_lim},U \leq U_lim\\0, Elsewhere \end{cases}
$$


在这里$X_lim=X(U_lim)$,$X$和$log X$的pdf通过变量的变化与下式相关：
$$
ρ（X|X_{lim})=\begin{cases} \frac{1}{X_lim},X \leq X_lim\\0, Elsewhere \end{cases}
$$

$$
ρ（\log X|log X_lim )=\begin{cases} \frac{e^{log X}}{X_lim},log X \leq log X_lim\\0, Elsewhere \end{cases}
$$

可知$U$与$X（U）$单调相关，因此，如果我们按$U$降序排列$K$个构型，他们也将按照$X$降序排列。

从我们的排序列表中选择第一个（最高能量）配置，t=![img](img/wps1.jpg)是一个β分布：
$$
ρ(t)=K_t^{K-1}
$$
这个pdf有平均值和标准差
$$
t=(\frac{K}{K+1}\pm\frac{1}{K+1}\sqrt{\frac{K}{K+2}})
$$
选择U值最高的构型，我们知道他对应的均值是![img](img/wps2.jpg)，标准差是![img](img/wps3.jpg)。将第i次迭代中U值最高的构型的能量记为U，将该构型存储为输出：
$$
X_{i-1}\times\frac{K}{K+1} \rightarrow X_i
$$

$$
U_largest \rightarrow U(X_i)
$$



最后，更新了$U_i\rightarrow U_lim$，通过重复寻找$U_{i+1}$，生成了新配置。



