<center>第17章</center>

# 模型稳健推断
****
到目前为止，我们主要依靠正态分布、二项分布和泊松分布以及这些分布的分层组合来对数据和参数进行建模。然而，使用有限的分布类别会导致有限的、可能不合适的推论类别。许多问题都不在方便的模型范围内，选择模型应该是为了适应基础科学和数据，而不仅仅是为了分析或计算上的方便。如第五章所示，创建现实模型的最有用的方法是分层工作，结合简单的单变量模型。如果为了方便使用了简单模型，就必须回答以下问题：后验推断在哪些方面取决于极端的数据点和不可靠的模型假设？我们已经在第六章中讨论了这个问题的后半部分，这基本上是敏感性分析的主题。本章采用更先进的计算方法，更详细地回到这个主题。

## 17.1 稳健性的各个方面
### _稳健模型对异常值的影响_

在基于正态分布的模型中对异常值是非常"非稳健"的，一个异常的数据点会强烈影响模型中所有参数的推断，包括一些与异常值没有什么实质性联系的参数。

例如，在第5.5节的教育测试例子中，我们通过将各个学校的平均值向大平均值移动（向真实效果来自共同正态分布的先验信息移动）得到对八个治疗效果的估计，每个学校j的移动比例只由其抽样误差σj和各学校效果间的变化τ决定。假设研究中第八所学校的观察值，即第120页表5.2中的$y_{8}$，是100而不是12，那么这八个观察值就是28、8、3、7、1、1、18和100，其标准误差与表5.2中的报告相同。如果我们对这个数据集应用层次正态模型，后验分布将告诉我们τ有一个很高的值，因此每个估计值θˆj将基本等于其观察到的效果yj。但这在实践中有意义吗？毕竟，考虑到这些假设的观察结果，第八所学校似乎有一个非常有效的SAT辅导项目，也可能这100个只是数据记录错误的结果。无论哪种情况，单一的观察值y8对我们如何估计
$\Theta_{1},...,\Theta_{7}$产生很大的影响可能是不对的。

在贝叶斯框架中，我们可以通过用长尾分布取代$\theta_{j}$的正态种群模型来减少反常的第八次观察的影响，这允许极端现象的发生。长尾指的是远离中心的概率含量相对较高的分布，其中"远离"的尺度是确定的。例如，相对于包含分布中50%概率的区域的直径。长尾分布包括t分布，其中最极端的情况是柯西或$\t_{1}$，以及（有限）混合模型，这些模型通常使用一个简单的分布，如正态分布的大部分值，但允许观察或参数值的离散概率来自另一个可能有不同中心的分布，这个分布通常传播范围更广。在SAT教练例子的假设性修改中，使用长尾分布对θj进行分析会导致观察值100被解释为来自长尾分布的极端抽样，而不是效果的正态分布具有高方差。由此产生的分析将使第八个观察值向其他观察值缩小，但不会像前七个观察值那样（相对于它与总体平均值的距离）向其他观察值缩小。(考虑到这个假设的数据集，后验概率$Pr\left(\Theta_{8}>100y\right)$应该小于0.5，这证明了一些收缩的合理性）。

正如假设的例子所示，我们不必放弃贝叶斯原则来处理异常值。例如，一个长尾模型，如柯西分布，甚至是一个双变量混合分布（见练习17.1），仍然是$\Theta_{1},...,\Theta_{8}$的可交换先验分布，当没有区分八个学校的先验信息时，这样做是合适的。可交换先验模型的选择会影响对$\theta_{j}$的估计值的缩减方式，因此我们可以减少一个离群的目标的影响，而不是在分析中以不同的方式处理它。(这不应该取代对数据的仔细检查和检查离群值中可能的记录错误）。寻找异常值的模型（可能是为了将其从分析中移除）与不受异常值影响的稳健模型之间有时会有区别。在贝叶斯框架中，这两种方法不应该被区分开来。例如，使用混合模型（如第22章中的有限混合模型或标准模型的过度分散版本）不仅会使极端观测值被归类为来自高方差的混合成分（而不是简单地出现"异常值"），而且还意味着这些点对估计值（如群体平均值和中位数）的推断影响较小。

### _灵敏度分析_

除了补偿异常值外，稳健模型还可用于评估后验推断对模型假设的灵敏度。例如，我们可以使用一个稳健的模型，用t分布来代替正态分布，通过将自由度从大到小的变化来评估对正态假设的灵敏度。正如第6章所讨论的，灵敏度分析的基本思想是尝试各种不同的分布的先验模型，观察其对感兴趣的估计量和预测量的后验推断有什么不同。一旦一个模型已经从后验分布中提取了样本，通常就可以直接使用重要性重采样从替代模型中提取样本，并且有足够的准确性来检测模型之间推断的主要差异（见第17.3节）。如果感兴趣估计值的后验分布对模型假设高度灵敏，则可能需要迭代模拟方法来进行更精确的计算。

从某种意义上说，第5.5节中对SAT辅导实验的大部分分析是一种灵敏度分析，其中允许参数τ在0到∞之间变化。正如第5.5节讨论的，观察到的数据实际上与所有等效的模型（即τ=0）是一致的，但是该模型没有实质意义，所以我们拟合了允许τ为任何正值的模型。结果总结为τ的边际后验分布（如图5.5所示），它描述了数据所支持的τ值的范围。
<div align=center>
<img src="https://user-images.githubusercontent.com/63713797/137932151-ab9537c6-9f7f-446e-bf45-8ef23d822c93.jpg" width= "30%" alt= "图5.5">
</div>

## 17.2 标准概率模型的过度分散版本

有时，使用标准模型(二项式、正态式、泊松式、指数式)似乎很自然，但数据过于分散。例如，正态分布不应该被用来拟合一个大样本，其中10%的点离中位数的距离超过1.5倍的四分位数范围。在上一节的假设例子中，我们建议θ′s的先验或群体模型应该有比正态更长的尾巴。对于每一个标准模型，实际上都有一个自然的扩展，在其中加入一个参数以允许过度分散。每个扩展模型都有一个解释，即混合分布。

所有这些分布的一个特点是，它们永远不可能是分散不足的。根据公式（2.7）和（2.8）以及混合解释，这是有道理的：广义分布的平均值与基础族的平均值相等，但方差更大。如果认为数据相对于标准分布来说是分散不足的，就应该使用不同的模型。

$E\left (\Theta\right )=E\left(E\left (\Theta|y\right)\right)$ &#8195; (2.7）

$var\left(\Theta\right)=E\left(var\left(\Theta|y\right)\right)+var\left(E\left(\Theta|y\right)\right) &#8195; (2.8)

### _正态分布的t分布替代_

t分布的尾部比正态分布长，可用于容纳（1）数据分布中偶尔出现的异常值，或（2）先验分布或分层模型中偶尔出现的极端参数。t系列分布$t_{v}\left(\mu,\sigma^{2}\right)$有三个参数：中心µ、尺度σ和一个决定分布形状的 "自由度 "参数ν。t密度是对称的，ν必须落在（0，∞）范围内。在ν=1时，t相当于柯西分布，它的长尾是无限的平均数和方差，当$v\to\propto$时，t接近正态分布。 如果t分布是一个概率模型的一部分，试图根据合理的大量数据准确地拟合一个长尾分布，那么一般来说，将自由度作为一个未知参数列入是合适的。在选择t作为正态分布的稳健替代的应用中，自由度可以固定在一个较小的数值上，以允许异常值的存在，但不能小于先前的要求。例如，有一个或两个自由度的t在远尾部具有无限的方差通常是不现实的。

### _混杂解释_

回顾第3.2节和第12.1节，$t_{v}\left(\mu,\sigma^{2}\right)$分布可以被解释为具有共同均值和方差的正态分布的混合分布，其分布方式为反比例$chi^{2}$。例如，模型$y\simt_{v}\left(\mu,\sigma^{2}\right)$等价于

<center>$y_{i}|V_{i}\sim N\left(\mu,V_{i}\right)$</center>  <br>

<center>$V_{i}\sim Inv-\chi^{2}\left(v,\sigma^{2}\right)$</center> &#8195; (17.1)

我们已经在第294页介绍了一个表达式（12.1）以说明辅助变量和参数展开的计算方法。在统计学上，具有高方差的观测值可以被认为是分布中的异常值。在对可交换参数$\Theta_{j}$进行建模时，也有类似的解释。

### _泊松分布的负二项分布替代_

将泊松模型应用于数据的一个常见困难是，泊松模型要求方差等于均值；在实践中，计数的分布往往是过度分散的，方差大于均值。我们已经在广义线性模型的背景下讨论了过度分散问题(节16.1)，(节16.4)给出了一个用于过度分散的泊松回归的层次正态模型的例子。
另一种对过度分散的数据进行建模的方法是使用负二项分布，这是一个双参数系列，允许分别拟合平均值和方差，方差大于等于平均值。服从$Neg-bin\left(\alpha,\beta\right)$分布的数据$y_{1},...,y_{n}$可看作是具有均值$\lambda_{1},...,\lambda_{n}$的泊松观测值，它遵循$Gamma\left(\alpha,\beta\right)$分布。负二项分布的方差是$\frac{\beta+1{\beta}\frac{\alpha}{\beta}$，它总大于平均值$\frac{\alpha}{\beta}$，而泊松分布的方差总是等于平均值。在$\beta\to\propto$和$\frac{\alpha}{\beta}$保持不变的情况下，基础伽马分布接近峰值，负二项分布接近泊松。

### _二项分布的β二项分布替代_

离散数据的二项分布模型有只有一个自由参数的限制，这意味着方差是由平均值决定的。一个标准的稳健的替代方法是β-二项分布，顾名思义，它是二项分布的β混合。例如，β二项分布被用来模拟教育测试数据，其中 "成功"是一个正确的反应，而个人在获得正确反应的概率上有很大的不同。在这里，数据$y_{i}$————每个人的正确回答数(i=1,...,n)用β-bin(m,α,β)分布来建模，并被认为具有共同的试验次数m和不等的概率$\pi_{1},...,\pi_{n}$的二项分布服从β(α,β)分布。具有平均概率$\frac{\alpha}{\alpha+\beta}$的β二项式的方差比具有相同概率的二项式的方差大$\frac{\alpha+\beta+m}{\alpha+\beta+1}$倍；见附录A表A.1。当m=1时，没有信息可用来区分β二项分布和二项分布的变化，且两个模型的方差相等。

### _logistic回归和probit回归的t分布替代_

logistic和probit回归可能是非稳健的，因为对于线性预测因子Xβ的大绝对值，逆logit或probit转换给出的概率接近于0或1。这样的模型可以通过允许偶尔对Xβ的值进行错误预测而变得更加稳健。这种形式的稳健性不是指数据y在二元回归中等于0或1，而是指预测因子X。一个更稳健的模型允许离散回归模型拟合大部分数据，而偶尔会出现孤立的错误。

一个稳健的robit回归模型，可以使用离散数据回归模型的潜在变量形式来实现（见第408页），用模型$u_{i}\sim t_{v}\left(\left(X\beta\right)_ {i},1\right)$取代潜在连续数据u的逻辑或正态分布。在现实环境中，从数据中估计ν是不切实际的--因为潜伏数据$u_{i}$从未被直接观察到，所以基本上不可能形成对其连续基础分布形状的推断--因此将其设置为一个较低值以确保稳健性。设置ν=4会产生一个接近Logistic的分布随着$v\to\propto$，模型接近probit分布。二元t回归的计算可以使用EM算法和Gibbs采样器，用正态混合公式(17.1)对潜在数据u的t分布进行计算，在这种方法中，$u_{i}$和每个$u_{i}$的方差被视为缺失数据。

### _为什么使用非稳健模型？_

t分布族的特例包括正态分布，那么我们为什么要使用正态分布，或者二项分布、泊松分布或其他标准模型呢？首先，每个标准模型都有一个逻辑地位，使得它在许多应用问题上是合理的。二项分布和多项分布适用于具有固定总数的独立同分布结果的离散计数。泊松分布和指数分布拟合了泊松过程的事件数和等待时间，是一个以时间为指标的独立离散事件的自然模型。最后，中心极限定理告诉我们，对于作为大量独立分量之和形成的数据，正态分布是一个合适的模型。在第5.5节的教育测试例子中，每一个观察到的效应$y_{j}$都是调整后的考试成绩的平均值，有$n_{j}\approx60$。也就是说，估计的治疗效应是基于j学校的大约60个学生。因此，我们可以用正态性精确地拟合近似$y_{j}$的抽样分布：
$y_{j}|\theta _{j},\sigma_{j}^{2}\sim N\left(\theta_{j},\sigma_{j}^{2}\right)$。

即使它们不是由问题的结构自然隐含的，标准模型在计算上也很方便，因为共轭先验分布常常允许直接计算后验均值和方差，并易于模拟。这就是在教育测试的例子中很容易将正态人口模型拟合到$\theta_{j}$上以及以及通常将正态模型拟合到全阳性数据的对数或被限制在0和1之间的数据的对数上的原因。如第六章所讨论的，当以这种或多或少的任意方式分配模型时，最好使用后验预测分布来检查数据的拟合情况。但如果我们担心假设的模型不稳健，那么就有必要进行灵敏度分析，观察如果我们换成更大的分布族，比如用t分布代替正态分布，后验推断会产生怎样大的变化。

## 17.3 后验推断和计算

我们可以使用第三部分所述的方法从后验分布（或在敏感性分析的情况下的其他分布）中抽取样本。在这一节中，我们简要地描述了Gibbs抽样在稳健模型的混合分布表述下的使用。该方法在第17.4节中对一个层次化的正态t模型进行了说明。然而，当扩展一个模型时，我们有可能采用耗时较少的近似方法作为替代：使用原始后验分布的抽样作为新模型模拟的起点。本节我们还描述了两种对稳健模型和敏感性分析有用的技术：在灵敏度分析中计算边缘后验密度的重要性加权，以及用于近似稳健分析的重要性重采样(第10.4节)。

### _作为简单模型展开稳健模型符号_

