# 共轭先验分布（conjugate prior distribution）

下面将介绍贝叶斯估计中一种简便计算后验分布的理论方法——共轭先验分布。

## 一、定义

在**贝叶斯概率理论**中，如果**后验概率** P(θ|x) 和**先验概率** p(θ) 满足**同样的**分布律，那么，先验分布和后验分布叫做**共轭分布**。同时，先验分布叫做似然函数 p(x|θ) 的**共轭先验分布**。



## 二、提出

1. 当没有任何观察数据时，随机变量 θ服从概率分布 P(θ)
2. 当观测到新的数据 X时，有如下问题： 
   1. 可否根据新观测到的数据X，更新参数 θ
   2. 根据新观测到的数据可以在多大程度上改变参数 θ : θ←θ+Δθ
   3. 当重新估计 θ的时候，如何给出其新的概率分布 p(θ|X)



## 三、数学原理

考虑来自单变量正态分布的n维独立观察向量y，即
$$
y～N(\mu,\sigma^2)
$$
其中σ2和给定σ2后的u具有以下分布：
$$
\mu|\sigma^2～N(\mu_0,\sigma^2/\kappa_0)\\\sigma^2～Inv-\chi^2(\nu_0,\sigma_0^2)
$$

> 具体推导过程参见Bayesian Data Analysis,Third Edition(C-Gelman,Andrew)的第二章

因此可以计算出联合密度，即**先验分布**：
$$
p(\mu,\sigma^2)\propto\sigma^{-1}(\sigma^2)^{-(\nu_0/2+1)}exp(\frac{-1}{2\sigma^2}[\nu_0\sigma_0^2+\kappa(\mu_0-\mu)^2])
$$
可以看到先验分布服从
$$
N-Inv-\chi^2(\mu_0,\sigma_0^2/\kappa_0;\nu_0,\sigma_0^2)
$$
这四个参数分别为u的位置和尺度参数，σ2的自由度和尺度参数。

##### *后验分布*

根据贝叶斯公式，由于贝叶斯公式中分母对于计算只起到归一化的作用，因此将先验分布乘正态分布可以得到**后验分布**的联合分布密度函数如下：
$$
p(\mu,\sigma^2|y)\propto\sigma^{-1}(\sigma^2)^{-(\nu_0/2+1)}exp(\frac{-1}{2\sigma^2}[\nu_0\sigma_0^2+\kappa(\mu_0-\mu)^2])\times\\(\sigma^2)^{-n/2}exp(-\frac{1}{2\sigma^2}[(n-1)s^2+n(\overline y-\mu)^2]\\=N-Inv-\chi^2(\mu_n,\sigma_n/\kappa_n;\nu_n,\sigma^2_n)
$$
可以看到，先验分布和后验分布具有相同的分布形式，先验分布和后验分布称为共轭分布。

根据下一部分(**后验分布的边缘分布函数**)，我们可以得到先验和后验分布中参数的关系
$$
\mu_n=\frac{\kappa_0}{\kappa_0+n}\mu_0+\frac{n}{\kappa_0+n}\overline y\\\kappa_n=\kappa_0+n\\\nu_n=\nu_0+n\\\nu_n\sigma^2_n=\nu_0\sigma^2+(n-1)s^2+\frac{\kappa_0n}{\kappa_0+n}(\overline y-\mu_0)^2
$$
后验分布参数结合了先验信息和数据中包含的信息。例如，μn是先验平均值和样本平均值的加权平均值，其权重由两条信息的相对精度决定。后自由度νn是前自由度加上样本量。后验平方和结合了前验平方和、样本平方和以及样本平均值与前验平均值之差所传递的额外不确定性。

##### *后验分布的边缘分布函数*

从后验分布的联合分布密度函数中可以得到：
$$
\sigma^2|y～Inv-\chi^2(\nu_n,\sigma^2_n)
$$


##### *从后验分布中抽样*

为了从后验分布中取样，我们首先将σ的后验边缘分布分离出来，然后依据σ在后验分布中的模拟值确定u的分布

##### 后验分布中u的边缘密度函数

$$
p(\mu|y)\propto(1+\frac{\kappa_n(\mu-\mu_n)^2}{\nu_n\sigma_n^2})^{-(\nu_n+1)/2}\\=t_{v_n}(\mu|\mu_n,\sigma_n^2/\kappa_n)
$$



## 四、案例及R语言实现

**案例：**某人用体重秤测量自己的体重，假设测量值服从标准差为3的正态分布，十次测量体重的观察值为182,172,173,176,176,180,173,174,179,175.对于真实体重的先验知识了解很少，并已知u～N(170,25)
**R语言实现：**

```R
pmean=170;pvar=25
weights=c(182,172,173,176,176,180,173,174,179,175)
xbar=mean(weights)
sigma0=3^2/length(weights)
post.precision=1/sigma0+1/pvar
post.var=1/post.precision#方差的倒数，称为精度
post.mean=(xbar/sigma0+pmean/pvar)/post.precision
c(post.mean,sqrt(post.var))
```

![image-20211008180039969](/Users/wwchen/Library/Application Support/typora-user-images/image-20211008180039969.png)

由图可知，该男子均值的后验分布为N(175.7915058,0.9320546)

## 五、补充

**常见的共轭先验分布**有以下几种：

|       总体分布       |    参数     |   共轭先验分布   |
| :------------------: | :---------: | :--------------: |
|       二项分布       |  成功概率p  |   β分布β(α,β)    |
|       泊松分布       |    均值λ    |   *τ*分布τ(αβ)   |
|       指数分布       | 均值的倒数χ |   *τ*分布τ(αβ)   |
| 正态分布（方差已知） |    均值μ    | 正态分布N(μ,σ^2) |
| 正态分布（均值已知） |   方差σ^2   |    倒*τ*分布     |



## 六、优点

**优点：**采用共轭先验分布的意义在于可以使得先验分布和后验分布的形式相同，这样当共轭先验分布是一个常见的分布时，可以很快地补出所需的常数项，从而得出后验分布。共轭先验也有助于获得关于似然函数如何更新先验分布的直观印象。

**选择共轭先验的原因**有两点：

1.共轭先验使得先验后验的形式相同，这样子更符合人的直观

2.可以形成一个先验链，现在的后验可以做为下一次的先验，如果共轭的话，则形式相同，便可以形成一个链条。





## 参考文献
Bayesian Data Analysis, Third Edition，C - Gelman, Andrew

https://blog.csdn.net/chenshulong/article/details/79034710

https://blog.csdn.net/weixin_45734379/article/details/114651728

https://www.cnblogs.com/xiaotu1617234/p/7242807.html
