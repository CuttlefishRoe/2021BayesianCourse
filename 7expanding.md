# 模型扩展

### 连续模型扩展

#### 敏感性分析

一般来说，模型参数的后验分布可以高估或低估“真实”后验不确定性的不同方面。后验分布通常高估了不确定性，因为人们通常不会在模型中包含一个人的所有实质性知识；因此，根据一个人的实质性知识检查模型的效用。另一方面，后验分布在两个方面低估了不确定性：首先，假设模型几乎肯定是错误的，因此需要对观察到的数据进行后验模型检查——其次，其他合理的模型可以同样很好地拟合观察到的数据，因此需要进行敏感性分析。在本节中，我们考虑由于存在合理的替代模型而导致的后验推断的不确定性，并讨论如何扩展模型以解释这种不确定性。替代模型的不同之处在于先验分布的规范、似然性的规范或两者都有。模型检查和敏感性分析相辅相成：在进行敏感性分析时，只需要考虑符合实际知识和观测数据的模型。
	 
敏感性分析的基本方法是对同一问题拟合多个概率模型。通常可以通过用代表实质性先验知识的适当分布替换不适当的先验分布来避免敏感性分析中的意外。此外，不同的问题受模型变化的影响不同。自然地，与关于均值或极端分位数的推断相比，关于后验分布中位数的后验推断通常对模型的变化更不敏感。类似地，对与观察数据最相似的量的预测推断是最可靠的；例如，在回归模型中，内插对线性假设的敏感度通常低于外推。有时可以使用“稳健”模型进行敏感性分析，以确保异常观察（或分层模型中更大的分析单元）不会对推论产生不当影响。典型的例子是使用 t 分布代替正态分布（用于抽样或人口分布）。这样的模型可能很有用，但需要更多的计算工作。  

  

#### 向模型添加参数

扩展模型有几个可能的原因:  

1. 如果模型在某些重要方面不适合数据或先验知识，则应该以某种方式对其进行更改，可能通过添加足够的新参数来实现更好的拟合。  
2. 如果建模假设有问题或没有真正的理由，可以扩大模型的类别（例如，用 t 替换正常值）。  
3. 如果考虑两个不同的模型 p1(y, θ) 和 p2(y, θ)，可以使用连续参数化将它们组合成一个更大的模型，将原始模型作为特殊情况包括在内。例如，第 5 章中的 SAT 辅导的层次模型是完全汇集(complete-pooling) (τ = 0) 和非汇集(no-pooling) (τ = ∞) 模型的连续推广。  
4. 可以扩展模型以包含新数据；例如，先前单独分析的实验可以插入到分层人口模型中。另一个常见的例子是将 y|x 的回归模型扩展为 (x, y) 的多元模型，以便对 x 中的缺失数据进行建模。  

   

模型扩展的所有这些应用都具有相同的数学结构：旧模型 p(y,θ) 嵌入或替换为新模型 p(y,θ,φ) 或更一般的 p(y,y*,θ,φ)，其中y*表示添加的数据。  
新参数 φ 和旧模型参数 θ 的联合后验分布为：   

$$p(θ, φ|y,y*) \propto p(φ)p(θ|φ)p(y,y*|θ,φ)$$ 

条件先验分布p(θ|φ) 和似然性p(y, y∗|θ,φ) 由扩展族确定。φ的边际分布是通过对θ 求平均得到的：  

$$p(φ|y,y*)\propto p(φ)\int [p(θ|φ)p(y,y*|θ,φ)dθ]\tag7.17$$

在贝叶斯模型的任何扩展中，必须指定一组先验分布 p(θ|φ) 来替换旧的 p(θ)，以及超参数上的超先验分布 p(φ)。这两项任务通常都需要思考，尤其是对于非信息性先验分布。  

  

#### 数据分析中模型选择的会计处理

我们通常只有在大量数据分析后才能构建模型的最终形式，这会导致与多重比较和预测误差估计等经典问题相关的担忧。如第 4.5 节所述，多重比较的贝叶斯处理使用分层建模，同时估计所有可能比较的联合分布并适当缩小这些分布（例如，在八学派的分析中，θj 都缩小到 µ，因此差异 θj−θk 会自动向 0 缩小）。尽管如此，仍会出现一些潜在的问题，例如可能对单个数据集进行多次分析以找到最有力的结论。 这对于所有应用的统计方法都是一种危险，并且只能通过贝叶斯尝试将所有不确定性来源纳入模型中来部分缓解。   

  

#### 预测因子的选择和信息的结合

在回归问题中，通常有许多不同的看似合理的方法来建立模型，这些不同的模型可以给出截然不同的答案。以预测变量的形式将现有信息放在一起几乎总是观察性研究中的一个问题，并且可以被视为模型规范问题。即使只有少数预测变量可用，我们也可以在可能的转换和交互中进行选择。

我们更喜欢在回归中包含尽可能多的预测变量，然后将它们缩放并分批到方差分析结构中，以便在某种程度上考虑它们而不是离散的输入或输出。即便如此，在选择要包含在层次模型本身中的变量时也必须做出选择。用于离散模型平均的贝叶斯方法在这里可能会有所帮助，尽管我们还没有在我们自己的研究中使用这种方法。

在观察性研究中为因果推断建立回归模型时，会出现一个相关且更基本的问题。在此，实质性背景中变量之间的关系是相关的，如在主要分层方法中，其中，在构建模型之后，需要额外的分析来计算相关因果估计，这些估计通常与回归系数不同。



#### 替代模型公式

我们经常发现向模型添加参数会使其更加灵活。例如，在正常模型中，我们更喜欢估计方差参数而不是将其设置为预先选择的值。在下一阶段，t 模型比普通模型更灵活（参见第 17 章），这已被证明在许多应用中具有实际意义。但为什么不这样做呢？在准确性和便利性之间总有一个平衡点。正如第 6 章所讨论的，预测模型检查可以揭示严重的模型不匹配，但我们还没有很好的一般原则来证明我们选择基本模型的合理性。随着分层模型的计算变得越来越常规，我们可能会开始使用更精细的模型作为默认值。很难为模型选择提供适当的一般建议；与模型构建一样，需要科学判断，方法必须因环境而异。

对于模型检查和敏感性分析，我们推荐的方法是检查实质性重要参数和预测量的后验分布。然后我们将后验分布和后验预测与实质性知识（包括观测数据）进行比较，并注意预测失败的地方。应该使用差异来建议模型可能的扩展，可能就像将真实的先验信息放入先验分布或在回归中添加非线性项等参数一样简单，或者可能需要一些实质性的重新思考，如总统选举模型中南方各州的预测差，如下：



有时模型的假设比显而易见的要强。例如，具有许多预测变量和系数的平稳先验分布的回归往往会高估系数之间的变化，就像对八所学校的独立估计过于分散一样。如果我们发现模型不适合其预期目的，我们有义务寻找适合的新模型；分析很少（如果有的话）仅仅通过拒绝某个模型来完成。  

如果敏感性分析揭示了问题，基本的解决方案是将其他似是而非的模型包含在先验规范中，从而形成反映模型规范中不确定性的后验推断，或者简单地报告对手头数据无法检验的假设的敏感性。有时必须得出结论，就实际目的而言，可用数据无法有效回答某些问题。在其他情况下，可以添加信息来约束模型，以允许进行有用的推理； 7.6 节给出了一个来自非正态总体的简单随机样本的例子，其中感兴趣的数量是总体总数。  

### 隐式假设和模型扩展：举例

尽管我们尽了最大努力来包含信息，但所有模型都是近似的。因此，检查模型对数据和先验假设的拟合总是很重要的。出于模型评估的目的，我们可以将贝叶斯数据分析的推理步骤视为一种复杂的方法，以这种方式探索所提出模型的所有含义，以便将这些含义与观察到的数据和未包含的其他知识进行比较。例如，第 6.4 节说明了针对心理学研究中两个不同问题的数据拟合模型的图形预测检查。在每种情况下，拟合模型都捕获了数据的一般模式，但遗漏了一些关键特征。在第二个示例中，发现模型失败会导致模型改进——患者和症状参数的混合分布更好地拟合数据，如下图所示。  

![image-20211017205558178](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\image-20211017205558178.png)

后验推论通常可以用图形来概括。对于简单问题或一维或二维总结，我们可以绘制后验模拟的直方图或散点图。对于较大的问题，汇总图很有用。几个独立推论的图有助于总结迄今为止的结果并建议未来的模型改进。

在检查模型时，必须牢记它的用途。例如，第 1.6 节中足球比分的正态模型准确地预测了获胜的概率，但对比赛完全打平的概率给出了糟糕的预测。

我们还应该知道自动贝叶斯推理的局限性。即使模型很好地拟合了观察到的数据，也可能对某些感兴趣的数量产生不良的推断。

看到当模型未经模型检查时可能出现的陷阱，令人惊讶且具启发性。

**例子：使用转换的正态模型估计简单随机抽样下的总体总数**

![image-20211017205714878](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\image-20211017205714878.png)

我们考虑从 n = 100 的简单随机样本中估计 1960 年纽约州 N = 804 个市镇的总人口的问题——一个人为的例子，但它说明了模型检查在避免严重错误推理方面的作用。表 7.2 总结了这次“调查”的总体以及两个简单的随机样本（这是第一个也是唯一选择的样本）。 由于了解总体情况，两个样本都显得特别不典型； 根据所提供的汇总统计数据，样本 1 代表总体，而样本 2 的值太大。 因此，乍一看，估计总体总数似乎很简单，可能高估了第二个样本的总数。

**样本 1：初步分析**。 我们首先尝试从样本 1 估计总体总数，假设总体中的 N 个值来自 N(µ, σ2 ) 超总体，在 (µ, log σ) 上具有统一的先验密度。 为了使用第 8 章中更正式引入的符号，我们希望估计有限人口数量：

<center>y_{total} = N\bar{y} =n\bar{y}_{obs}  +(N-n)\bar{y}_{mis} </center>

其中，$y_{bos} $ 是 100 个观察到的城市的平均值，$y_{mis} $是其他 704 个城市的平均值。正如我们在 8.3 节中讨论的，在这个模型下，y 的后验分布是 tn−1(yobs ,( 1 n − 1 N )s 2 obs )。使用来自表 7.2 第二列的数据和列表中的 t 分布，我们获得了 ytotal 的以下 95% 后验区间：[−5.4 × 106 , 37.0 × 106 ]。检查这个 95% 区间的实际人员可能会发现上限很有用，并简单地用样本中的总数替换下限，因为总体中的总数不能更少。此过程给出了 [2.0 × 106 , 37.0 × 106 ] 的 95% 区间估计。

